<!DOCTYPE html>
<meta charset="utf-8">

<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

    var width = 960,
        height = 500;

    var canvas = d3.select("body").append("canvas")
        .attr("width", width)
        .attr("height", height);

    var context = canvas.node().getContext("2d");

    var projection = d3.geo.kavrayskiy7(),
        color = d3.scale.category20(),
        graticule = d3.geo.graticule();

    var path = d3.geo.path()
        .projection(projection)
        .context(context);


    context.strokeStyle = '#000';
    context.beginPath();
    path(graticule());
    context.lineWidth = .5;
    context.stroke();

    context.strokeStyle = '#333';
    context.beginPath();
    path(graticule.outline());
    context.lineWidth = 1.5;
    context.stroke();


    country_val_map = {};
    d3.tsv("data/countries_with_vals.tsv", function(error, country_val) {

        country_val.forEach(function (country) {
            var name = country["Country"];
            country_val_map[name] = country["Value"];
        });
    });


    d3.json("data/world-50m.json", function(error, world) {
        d3.csv("data/iso_3166.csv", function(error, iso_data) {

//            console.log(country_val);

//            country_val_map = {};
//            country_val.forEach(function(country) {
//                var name = country["Country"];
//                country_val_map[name] = country["Value"];
//            });

            iso_data.forEach(function(country) {
                if (country.name == "Sweden") {
                    var name = country.name;

                    console.log(country);
                    console.log(country['country-code']);

                    console.log("Value", country_val_map[name]);
                }
            });
//            console.log(iso_data[0]);


            var countries = topojson.feature(world, world.objects.countries).features,
                neighbors = topojson.neighbors(world.objects.countries.geometries);


            countries.forEach(function(d, i) {

                var my_color;
                if (d.id == 752) {
                    console.log(d);
//                var test_color = color(d.color = d3.max(neighbors[i], function(n) { return countries[n].color; }) + 1 | 0);
//                console.log(test_color);
                    my_color = color(10);
                }
                else {
                    my_color = color(d.color = d3.max(neighbors[i], function(n) { return countries[n].color; }) + 1 | 0);
                }
                context.fillStyle = color(my_color);
//            context.fillStyle = color(d.color = d3.max(neighbors[i], function(n) { return countries[n].color; }) + 1 | 0);

                context.beginPath();
                path(d);
                context.fill();
            });
        });
    });

</script>

</body>
